(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-67eca906"],{"1b62":function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return p}));n("d81d");var a=n("cdd9"),r={data:function(){return{isCollapse:!1,reSubmit:!1,loading:!1,opTitle:"",opType:"",opKey:1,opDialog:!1,clearFk:1,mulSelection:[]}},methods:{commonEdit:function(e){var t=this;this.opType="edit",this.modalData=e,this.opKey++,setTimeout((function(){t.opDialog=!0}),a["a"].modalTime)},commonAdd:function(){var e=this;this.opType="add",this.opKey++,setTimeout((function(){e.opDialog=!0}),a["a"].modalTime)},callbackModal:function(){this.fetchData()},onReset:function(){this.$refs["formData"].resetFields(),this.clearFk++},handleSelectionChange:function(e){this.mulSelection=e},preDeleteBatch:function(e){var t=[];this.mulSelection.map((function(n){t.push(n[e])})),this.handleDelete(t)},preDelete:function(e,t,n){n&&n.stopPropagation();var a=[e[t]];this.handleDelete(a)}}},i=n("5530"),o=n("f66f"),s=n("1a40"),c=n("5d85"),u=n("94d2"),l=n("2f62"),d=n("e350"),p={components:{tablePagination:o["a"],OperateButton:s["a"],baseForm:c["a"],colorWord:u["a"]},computed:Object(i["a"])({},l["c"]["userInfo"]),methods:{checkPerm:d["a"],checkUser:d["b"],handleDia:function(e){var t=this,n=e.row,a=void 0===n?{}:n,r=e.options,i=e.cb,o=e.nextTickCb;r=Object.assign(r,{visible:!0,currentFormValue:a}),i&&i(),this.$nextTick((function(){o&&o(),r.ref&&t.$refs[r.ref].clear()}))},handleValidate:function(e){var t=this,n=e.refname,a=e.cb;this.$nextTick((function(){t.$refs[n].handleFormValidate((function(e){a&&a(e)}))}))},isDo:function(e){var t=e.cb,n=e.title,a=e.catchcb,r=void 0===a?function(){}:a;this.$confirm(n,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(t).catch(r)},go:function(e){this.$router.push(e)},message:function(e,t){this.$message({message:t,type:e})}}}},"2d9d":function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"c-dialog"},[n("el-dialog",{directives:[{name:"drag-dialog",rawName:"v-drag-dialog"}],attrs:{title:e.modalTitle,visible:e.dialog,"before-close":e.closeHandle,width:e.width||"580px"},on:{"update:visible":function(t){e.dialog=t}}},[n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[e._t("default"),n("div",{staticClass:"c-dialog__footer",attrs:{slot:"footer"},slot:"footer"},[e._t("button"),e.noCancle?e._e():n("el-button",{attrs:{size:"mini"},on:{click:e.closeHandle}},[e._v("取消")])],2)],2)])],1)},r=[],i={props:["dialog","modalTitle","callback","refname","loading","width","noCancle"],methods:{closeHandle:function(){this.$emit("dealDialog")}}},o=i,s=n("2877"),c=Object(s["a"])(o,a,r,!1,null,null,null);t["a"]=c.exports},5899:function(e,t){e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(e,t,n){var a=n("1d80"),r=n("5899"),i="["+r+"]",o=RegExp("^"+i+i+"*"),s=RegExp(i+i+"*$"),c=function(e){return function(t){var n=String(a(t));return 1&e&&(n=n.replace(o,"")),2&e&&(n=n.replace(s,"")),n}};e.exports={start:c(1),end:c(2),trim:c(3)}},"5a12":function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return i})),n.d(t,"c",(function(){return o}));var a=function(e){var t=/^1[3|4|5|7|8][0-9]\d{8}$/;return t.test(e)},r=function(e,t,n){""===t||null===t||void 0===t||a(t)?n():n(new Error("请输入正确的11位手机号码"))},i=/^[A-Za-z0-9_-]+$/,o=/^((([a-z0-9_\.-]+)@([\da-z\.-]+)\.([a-z\.]{2,6}\,))*(([a-z0-9_\.-]+)@([\da-z\.-]+)\.([a-z\.]{2,6})))$/},"77e91":function(e,t,n){"use strict";n("4160"),n("c975"),n("ac1f"),n("1276"),n("159b");var a=n("b775"),r=n("51be"),i=r["a"],o={validCode:{url:i+"/api/topic/uniqueCheck",method:"get"},applicant:{url:i+"/api/userinfo/queryApplicants",method:"get"},getTopicsByClusterId:{url:i+"/api/topic/getTopicsByClusterId",method:"get"},getTopicsByCluster:{url:i+"/api/topic/getTopicsByCluster",method:"get"}},s={list:{url:i+"/api/env/listEnvironment",method:"get"}},c={list:{url:i+"/api/service/listClusters",method:"get"}},u={list:{url:i+"/api/consumer/queryApprovedConsumers",method:"get"},getApproveTopicList:{url:i+"/api/topic/getTopicsByClusterId",method:"get"},getConsumersByClusterId:{url:i+"/api/consumer/getConsumersByClusterId",method:"get"},validCode:{url:i+"/api/consumer/uniqueCheck",method:"post"}},l={theme:o,cluster:c,consumer:u,environment:s};function d(e){if(-1===e.indexOf("_"))return l[e];var t=l;return e.split("_").forEach((function(e){t=t[e]})),t}t["a"]={accessAPI:function(e){var t=e.apiUrl,n=void 0===t?"":t,r=e.params,i=void 0===r?{}:r,o=e.headers,s=void 0===o?{}:o,c={headers:s},u=d(n);return Object.assign(c,{url:u.url,method:u.method}),"get"===u.method?Object.assign(c,{params:i}):"post"!==u.method&&"put"!==u.method&&"patch"!==u.method&&"delete"!==u.method||Object.assign(c,{data:i}),Object(a["a"])(c)}}},a15b:function(e,t,n){"use strict";var a=n("23e7"),r=n("44ad"),i=n("fc6a"),o=n("b301"),s=[].join,c=r!=Object,u=o("join",",");a({target:"Array",proto:!0,forced:c||u},{join:function(e){return s.call(i(this),void 0===e?",":e)}})},a623:function(e,t,n){"use strict";var a=n("23e7"),r=n("b727").every,i=n("b301");a({target:"Array",proto:!0,forced:i("every")},{every:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}})},a9e3:function(e,t,n){"use strict";var a=n("83ab"),r=n("da84"),i=n("94ca"),o=n("6eeb"),s=n("5135"),c=n("c6b6"),u=n("7156"),l=n("c04e"),d=n("d039"),p=n("7c73"),m=n("241c").f,f=n("06cf").f,g=n("9bf2").f,b=n("58a8").trim,v="Number",h=r[v],O=h.prototype,y=c(p(O))==v,w=function(e){var t,n,a,r,i,o,s,c,u=l(e,!1);if("string"==typeof u&&u.length>2)if(u=b(u),t=u.charCodeAt(0),43===t||45===t){if(n=u.charCodeAt(2),88===n||120===n)return NaN}else if(48===t){switch(u.charCodeAt(1)){case 66:case 98:a=2,r=49;break;case 79:case 111:a=8,r=55;break;default:return+u}for(i=u.slice(2),o=i.length,s=0;s<o;s++)if(c=i.charCodeAt(s),c<48||c>r)return NaN;return parseInt(i,a)}return+u};if(i(v,!h(" 0o1")||!h("0b1")||h("+0x1"))){for(var _,j=function(e){var t=arguments.length<1?0:e,n=this;return n instanceof j&&(y?d((function(){O.valueOf.call(n)})):c(n)!=v)?u(new h(w(t)),n,j):w(t)},k=a?m(h):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),x=0;k.length>x;x++)s(h,_=k[x])&&!s(j,_)&&g(j,_,f(h,_));j.prototype=O,O.constructor=j,o(r,v,j)}},b567:function(e,t,n){"use strict";var a=n("d58f5"),r=n.n(a);r.a},c315:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"l-page l-page--flex theme-application"},[n("div",{staticClass:"page-nav"},[e._v("消费组管理")]),n("div",{staticClass:"l-page__content"},[n("div",{staticClass:"content--padding"},[n("div",{staticClass:"content__header"},[n("div",{staticStyle:{float:"left"}},[e._v(" 状态 "),n("el-select",e._b({attrs:{size:"mini"},on:{change:e.statusChange},model:{value:e.status,callback:function(t){e.status=t},expression:"status"}},"el-select",e.GLOBAL.select,!1),e._l(e.SearchStatus.options,(function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),n("el-input",{staticStyle:{"margin-left":"15px",width:"300px"},attrs:{size:"mini",placeholder:"搜索  ( 消费组 、主题名 、申请人 )"},on:{change:e.searchMaintable},model:{value:e.keyWord,callback:function(t){e.keyWord=t},expression:"keyWord"}})],1),n("div",{staticStyle:{float:"right"}},[n("el-button",e._b({attrs:{icon:"el-icon-circle-plus"},on:{click:e.operateOpen}},"el-button",e.GLOBAL.button,!1),[e._v(" 新增 ")]),e.checkPerm(["admin"])?n("el-button",e._b({attrs:{type:"",icon:"el-icon-refresh"},on:{click:e.syncOpen}},"el-button",e.GLOBAL.button,!1),[e._v(" 多环境同步 ")]):e._e()],1)]),n("div",{staticClass:"content__body"},[n("table-pagination",e._b({attrs:{"data-handler":e.handleTableData},on:{changePage:e.pageHandler}},"table-pagination",e.maintable,!1),[n("template",{slot:"insert"},[n("el-table-column",{attrs:{label:"操作",fixed:"right",width:"55",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-dropdown",{attrs:{trigger:"click",size:"medium"}},[n("span",{staticClass:"el-dropdown-link"},[n("i",{staticClass:"el-icon-menu el-icon--right"})]),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",[n("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-edit",disabled:!(e.checkPerm(["admin"])||t.row.applicant===e.userInfo.realName)},on:{click:function(n){return e.operateEdit(t.row)}}},[e._v(" 编辑 ")])],1),n("el-dropdown-item",[n("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-delete",disabled:!(e.checkPerm(["admin"])||t.row.applicant===e.userInfo.realName)},on:{click:function(n){return e.handleDelete(t.row)}}},[e._v(" 删除 ")])],1),n("el-dropdown-item",[n("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-s-check",disabled:!e.checkPerm(["admin"])},on:{click:function(n){return e.approvalConsumer(t.row)}}},[e._v(" 审批 ")])],1),n("el-dropdown-item",[n("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-setting",disabled:!(e.checkPerm(["admin"])&&(1===t.row.status||3===t.row.status))},on:{click:function(n){return e.handleConfig(t.row)}}},[e._v(" 配置 ")])],1)],1)],1)]}}])})],1),n("template",{slot:"insert2"},[n("el-table-column",e._b({attrs:{label:"消费组",fixed:"left",width:"250"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("color-word",{attrs:{type:"link",disabled:0===t.row.status||2===t.row.status},on:{click:function(n){return e.viewDetail(t.row)}}},[e._v(" "+e._s(t.row.name)+" ")])]}}])},"el-table-column",e.GLOBAL.column,!1))],1),n("template",{slot:"insert3"},[n("el-table-column",e._b({attrs:{label:"状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",{class:t.row.statusClass},[e._v(e._s(t.row.statusTxt))])]}}])},"el-table-column",e.GLOBAL.column,!1))],1),n("template",{slot:"insert4"},[n("el-table-column",e._b({attrs:{label:"环境",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.consumerEnvironmentRefVos.length?n("div",{staticClass:"service-column"},e._l(t.row.consumerEnvironmentRefVos,(function(a,r){return n("el-popover",{key:r,attrs:{placement:"right",width:"200",trigger:"hover"}},[n("el-card",{staticClass:"zms-host-card",attrs:{shadow:"never"}},e._l(t.row.consumerEnvironmentRefVos,(function(t,a){return n("div",{key:a},[n("span",[e._v(e._s(t.environmentName+" : "))]),t.clusterType?n("el-tooltip",{attrs:{content:t.clusterType.toLowerCase(),placement:"top",effect:"light"}},[n("svg-icon",{attrs:{"icon-class":e.serviceIconClass(t.clusterType)}})],1):e._e(),n("span",{staticClass:"card-item",on:{click:function(n){return e.goServiceDetail(t.serviceId,"state")}}},[e._v(" "+e._s(t.clusterName)+" ")])],1)})),0),n("span",{staticClass:"content_envTxt",class:e.envType(a.environmentId),attrs:{slot:"reference"},slot:"reference"},[e._v(" "+e._s(a.environmentName)+" ")])],1)})),1):n("div",[e._v(e._s(e._f("isEmpty")(t.row.envTxt)))])]}}])},"el-table-column",e.GLOBAL.column,!1))],1)],2)],1)])]),n("op-freight",{attrs:{dialog:e.diaOptions.visible,modalTitle:e.diaOptions.diatitle[e.diaOptions.status],loading:e.diaOptions.loading},on:{dealDialog:e.closeDia}},[n("base-form",{ref:e.diaOptions.ref,attrs:{forms:e.diaOptions.forms,"current-form-value":e.diaOptions.currentFormValue,"label-width":"120px"}}),n("template",{slot:"button"},[n("el-button",e._b({on:{click:e.saveData}},"el-button",e.GLOBAL.button,!1),[e._v("保存")])],1)],2),n("op-freight",{attrs:{dialog:e.approvalOptions.visible,modalTitle:e.approvalOptions.diatitle,loading:e.approvalOptions.loading},on:{dealDialog:e.closeApprovalDia}},[n("base-form",{ref:e.approvalOptions.ref,attrs:{forms:e.approvalOptions.forms,"current-form-value":e.approvalOptions.currentFormValue,"label-width":"120px"}}),n("template",{slot:"button"},[n("el-button",e._b({on:{click:e.saveApprovalData}},"el-button",e.GLOBAL.button,!1),[e._v("保存")])],1)],2),n("op-freight",{attrs:{dialog:e.configOptions.visible,modalTitle:e.configOptions.diatitle,loading:e.configOptions.loading},on:{dealDialog:e.closeConfigOptions}},[n("base-form",{ref:e.configOptions.ref,attrs:{forms:e.configOptions.forms,"current-form-value":e.configOptions.currentFormValue,"label-width":"120px"}}),n("template",{slot:"button"},[n("el-button",e._b({on:{click:function(t){return e.saveConfigData()}}},"el-button",e.GLOBAL.button,!1),[e._v("保存")])],1)],2),n("op-freight",{attrs:{dialog:e.diaSyncOptions.visible,modalTitle:e.diaSyncOptions.diatitle,loading:e.diaSyncOptions.loading},on:{dealDialog:e.closeSyncDia}},[n("base-form",{ref:e.diaSyncOptions.ref,attrs:{forms:e.diaSyncOptions.forms,"current-form-value":e.diaSyncOptions.currentFormValue,"label-width":"90px"}}),n("template",{slot:"button"},[n("el-button",e._b({on:{click:e.beginSync}},"el-button",e.GLOBAL.button,!1),[e._v("开始同步")])],1)],2)],1)},r=[],i=(n("a15b"),n("d81d"),n("96cf"),n("1da1")),o=n("1b62"),s=(n("b0c0"),n("5530")),c=n("d9d3"),u=n("12de"),l={data:function(){return{formData:{consumerName:"",topicName:"",applicant:"",status:void 0},SearchCluster:{options:[],loading:!1},SearchTheme:{options:[],loading:!1},SearchConsumer:{options:[],loading:!1},SearchApplicant:{options:[],loading:!1},SearchStatus:{options:[{label:"待审批",value:0},{label:"已审批",value:1}]}}},computed:{consumerName:function(){return this.formData.consumerName}},watch:{consumerName:function(){this.formData.topicName=""}},methods:{consumeChange:function(e){this.$refs.form.specialSet({prop:"topicName",val:e.topicName})},getClusterOptions:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.SearchCluster.loading=!0,t.next=3,Object(u["h"])();case 3:n=t.sent,n.result&&(e.SearchCluster.options=n.result.map((function(e){return Object(s["a"])({label:e.serverName,value:e.serverName},e)})),e.SearchCluster.loading=!1);case 5:case"end":return t.stop()}}),t)})))()},getConsumerOptions:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.SearchConsumer.loading=!0,n={},t.next=4,Object(c["n"])(n);case 4:a=t.sent,a.result&&(e.SearchConsumer.options=a.result.map((function(e){return Object(s["a"])({label:e.name,value:e.name},e)}))),e.SearchConsumer.loading=!1;case 7:case"end":return t.stop()}}),t)})))()},getThemeOptions:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.SearchTheme.loading=!0,n={},t.next=4,Object(u["r"])(n);case 4:a=t.sent,a.result&&(e.SearchTheme.options=a.result.map((function(e){return Object(s["a"])({label:e.name,value:e.name},e)}))),e.SearchTheme.loading=!1;case 7:case"end":return t.stop()}}),t)})))()},getApplicantOptions:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.SearchApplicant.loading=!0,t.next=3,Object(u["a"])();case 3:n=t.sent,n.result&&(e.SearchApplicant.options=n.result.map((function(e){return{label:e,value:e}}))),e.SearchApplicant.loading=!1;case 6:case"end":return t.stop()}}),t)})))()},searchHandler:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.$refs.formData.validate((function(n){n&&(t=Object.assign({},t,e.formData),e.loadTabledata(e.formData))}))}}},d=n("2f62"),p=n("5a12"),m=n("2d9d"),f={data:function(){return{components:{OpFreight:m["a"]},diaOptions:{visible:!1,ref:"consumerform",status:0,id:0,topicId:0,diatitle:["新增","编辑"],forms:[{prop:"name",label:"消费者名称",checkApi:{apiUrl:"consumer_validCode",message:"已存在或者以前使用过，请更换",paramkey:"name"},rules:[{required:!0,message:"请输入主题名",trigger:"blur"},{max:100,message:"小于100个字符",trigger:"blur"},{pattern:p["a"],message:"请输入数字、字母、下划线、中划线",trigger:"blur"}]},{prop:"topicId",label:"主题名",itemType:"remoteselect",apiUrl:"consumer_getApproveTopicList",labelkeyname:"name",valuekeyname:"id",autoget:!0,rules:[{required:!0,message:"主题名为必填项",trigger:"change"}]},{prop:"broadcast",label:"广播消费",itemType:"radio",defaultValue:!1,options:[{label:"是",value:!0},{label:"否",value:!1}],rules:[{required:!0,message:"是否为广播消费主题名为必选项",trigger:"blur"}]},{prop:"consumerFrom",label:"最早消费",itemType:"radio",defaultValue:!1,options:[{label:"是",value:!0},{label:"否",value:!1}],rules:[{required:!0,message:"是否为最早消费主题名为必选项",trigger:"blur"}]},{prop:"applicant",label:"申请人",rules:[{required:!0,message:"申请人为必填项",trigger:"change"}]},{prop:"domain",label:"申请域(appId)",placeholder:"业务英文名字",rules:[{required:!0,message:"请输入申请域(appId)",trigger:"blur"}]},{prop:"delayThreadhold",label:"积压阈值",itemType:"number",min:0,step:500,defaultValue:1e3,stepStrictly:!0,slots:[{type:"append",text:""}],rules:[{required:!0,message:"请输入积压阈值"}]},{prop:"memo",label:"备注",inputType:"textarea",placeholder:"1.申请消费组业务用途 \n2.广播消费原因描述 \n3.最早消费原因描述",rules:[{required:!0,message:"请输入备注",trigger:"blur"},{max:100,message:"最多输入100个字符",trigger:"blur"}]}],currentFormValue:{},loading:!1}}},computed:Object(s["a"])({},Object(d["d"])({userInfo:function(e){return e.user.userInfo},envListData:function(e){return e.theme.envListData}})),methods:Object(s["a"])(Object(s["a"])({},Object(d["b"])({getEnvList:"theme/getEnvList"})),{},{topicChange:function(e){this.diaOptions.currentValue.topicId=e.id,this.$refs.consumerform.specialSet({prop:"topicId",val:e.id})},EnvList:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.envListData,e.diaOptions.loading=!0,void 0!==n){t.next=5;break}return t.next=5,e.getEnvList();case 5:e.diaOptions.loading=!1;case 6:case"end":return t.stop()}}),t)})))()},operateOpen:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.handleDia({options:e.diaOptions,cb:function(){e.diaOptions.status=0,Object.assign(e.diaOptions.forms[0],{defaultValue:"",disabled:!1}),Object.assign(e.diaOptions.forms[1],{defaultValue:"",disabled:!1}),Object.assign(e.diaOptions.forms[4],{defaultValue:e.userInfo.realName,disabled:!0,itemType:"input"})}});case 1:case"end":return t.stop()}}),t)})))()},operateEdit:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:t.id=e.id,a=Object(s["a"])({},e),Array.isArray(a.environments)&&(a.environments=e.environments.map((function(e){return e.environmentId}))),t.handleDia({options:t.diaOptions,row:a,cb:function(){t.diaOptions.status=1,Object.assign(t.diaOptions.forms[0],{defaultValue:"",disabled:!0}),Object.assign(t.diaOptions.forms[4],{defaultValue:"",itemType:"remoteselect",apiUrl:"theme_applicant",disabled:!1}),Object.assign(t.diaOptions.forms[1],{defaultValue:"",disabled:!0})}});case 4:case"end":return n.stop()}}),n)})))()},closeDia:function(){Object.assign(this.diaOptions,{visible:!1})},saveData:function(){var e=this;this.handleValidate({refname:"consumerform",cb:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(n){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=n.environments,console.info(JSON.stringify(a)),n.id=e.id,0!==e.diaOptions.status){t.next=8;break}return t.next=6,Object(c["h"])(n);case 6:t.next=11;break;case 8:return r=e.diaOptions.currentFormValue.id,t.next=11,Object(c["i"])(r,n);case 11:e.closeDia(),e.loadTabledata();case 13:case"end":return t.stop()}}),t)})));function n(e){return t.apply(this,arguments)}return n}()})},handleDelete:function(e){var t=this,n={id:e.id};this.isDo({title:"您是否确定删除【".concat(e.name,"】消费者？删除后不可恢复！"),cb:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.maintable.loading=!0,e.next=3,Object(c["c"])(n);case 3:t.message("success","删除成功"),t.loadTabledata();case 5:case"end":return e.stop()}}),e)})));function a(){return e.apply(this,arguments)}return a}()})}})},g=n("2909"),b={data:function(){return{forms:[{prop:"name",label:"消费者名称",checkApi:{apiUrl:"name_validCode",message:"已存在或者以前使用过，请更换",paramkey:"name"},rules:[{required:!0,message:"请输入主题名",trigger:"blur"},{max:100,message:"小于100个字符",trigger:"blur"},{pattern:p["a"],message:"请输入数字、字母、下划线、中划线",trigger:"blur"}]},{prop:"topicId",label:"主题名",itemType:"remoteselect",labelkeyname:"name",valuekeyname:"id",disabled:!0,autoget:!0,apiUrl:"consumer_getApproveTopicList",rules:[{required:!0,message:"主题名为必填项",trigger:"change"}]},{prop:"broadcast",label:"广播消费",itemType:"radio",defaultValue:!1,options:[{label:"是",value:!0},{label:"否",value:!1}],rules:[{required:!0,message:"是否为广播消费主题名为必选项",trigger:"blur"}]},{prop:"consumerFrom",label:"最早消费",itemType:"radio",defaultValue:!1,options:[{label:"是",value:!0},{label:"否",value:!1}],rules:[{required:!0,message:"是否为最早消费主题名为必选项",trigger:"blur"}]},{prop:"applicant",label:"申请人",disabled:!0,rules:[{required:!0,message:"申请人为必填项",trigger:"change"}]},{prop:"domain",label:"申请域(appId)",placeholder:"业务英文名字",rules:[{required:!0,message:"请输入申请域(appId)",trigger:"blur"}]},{prop:"delayThreadhold",label:"积压阈值",itemType:"number",min:0,step:500,stepStrictly:!0,placeholder:"最大积压阈值",slots:[{type:"append",text:""}],rules:[{required:!0,message:"请输入积压阈值"}]},{prop:"memo",label:"备注",inputType:"textarea",placeholder:"1.申请消费组业务用途 \n2.广播消费原因描述 \n3.最早消费原因描述",rules:[{required:!0,message:"请输入备注",trigger:"blur"},{max:100,message:"最多输入100个字符",trigger:"blur"}]}],approvalOptions:{visible:!1,ref:"approvalForm",diatitle:"消费组审批",forms:[],currentFormValue:{},loading:!1,id:0}}},computed:Object(s["a"])({},Object(d["d"])({envListData:function(e){return e.theme.envListData}})),methods:Object(s["a"])(Object(s["a"])({},Object(d["b"])({getEnvList:"theme/getEnvList"})),{},{approvalEnvList:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.envListData,e.approvalOptions.loading=!0,void 0!==n){t.next=5;break}return t.next=5,e.getEnvList();case 5:e.approvalOptions.loading=!1;case 6:case"end":return t.stop()}}),t)})))()},approvalConsumer:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a=Object(s["a"])({},e),t.id=e.id,t.approvalOptions.forms=Object(g["a"])(t.forms),n.next=5,t.approvalEnvList();case 5:t.handleDia({options:t.approvalOptions,row:a,cb:function(){var n=!1;e&&0!==e.status&&(n=!0),t.approvalOptions.forms[0].disabled=n}});case 6:case"end":return n.stop()}}),n)})))()},closeApprovalDia:function(){Object.assign(this.approvalOptions,{visible:!1})},saveApprovalData:function(){var e=this;this.handleValidate({refname:"approvalForm",cb:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(n){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.approvalOptions.currentFormValue.id,n.id=a,t.next=4,Object(c["a"])(a,n);case 4:e.closeApprovalDia(),e.loadTabledata();case 6:case"end":return t.stop()}}),t)})));function n(e){return t.apply(this,arguments)}return n}()})}})},v=(n("99af"),n("4de4"),n("4160"),n("159b"),{data:function(){return{configForms:[{prop:"name",label:"消费名",disabled:!0,rules:[{required:!0,message:"请输入主题名",trigger:"blur"}]},{prop:"consumerEnvironmentRefVos",label:"环境选择",itemType:"checkbox",options:[],rules:[{required:!0,message:"请选择主题环境",trigger:"blur"}],disabled:!0}],configOptions:{visible:!1,diatitle:"【消费】灰度配置",ref:"configform",id:0,envId:1,forms:[]}}},computed:Object(s["a"])({},Object(d["d"])({userInfo:function(e){return e.user.userInfo},envListData:function(e){return e.theme.envListData}})),methods:Object(s["a"])(Object(s["a"])({},Object(d["b"])({getEnvList:"theme/getEnvList"})),{},{gatedClusterChange:function(e){this.configOptions.currentValue.gatedClusterId=e.id,this.$refs.configform.specialSet({prop:"gatedIps",val:e.ips})},configEnvList:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.envListData,e.configOptions.loading=!0,void 0!==n){t.next=5;break}return t.next=5,e.getEnvList();case 5:e.configOptions.loading=!1;case 6:case"end":return t.stop()}}),t)})))()},handleConfig:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var a,r,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.id=e.id,n.next=3,t.configEnvList();case 3:t.configOptions.forms=Object(g["a"])(t.configForms),r=Object(s["a"])({},e),r.consumerEnvironmentRefVos=[],Array.isArray(r.consumerEnvironmentRefVos)&&e.consumerEnvironmentRefVos.forEach((function(e){r.consumerEnvironmentRefVos.push(e.environmentId),r["cluster_"+e.environmentId]=e.gatedServiceId,r["clusterIp_"+e.environmentId]=e.gatedIps})),i=r.consumerEnvironmentRefVos.map((function(e){var n=t.envListData.filter((function(t){return t.id===e}))[0];return[{prop:"cluster_"+e,label:n.environmentName+"灰度集群",itemType:"remoteselect",apiUrl:"cluster_list",remoteParams:{envId:e},labelkeyname:"serverName",valuekeyname:"id",autoget:!0,rules:[{required:!0,message:"请选择",trigger:"blur"}]},{prop:"clusterIp_"+e,label:n.environmentName+"灰度IP"}]})),t.configOptions.forms=(a=t.configOptions.forms).concat.apply(a,Object(g["a"])(i)),t.handleDia({options:t.configOptions,row:r,cb:function(){Object.assign(t.configOptions.forms[1],{options:t.envListData.map((function(e){return Object(s["a"])({label:e.environmentName,value:e.id},e)}))})}});case 10:case"end":return n.stop()}}),n)})))()},closeConfigOptions:function(){Object.assign(this.configOptions,{visible:!1})},saveConfigData:function(){var e=this;this.handleValidate({refname:"configform",cb:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(n){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=n.consumerEnvironmentRefVos,n.consumerEnvironmentRefVos=a.map((function(e){var t=n["cluster_"+e];delete n["cluster_"+e];var a=n["clusterIp_"+e];return delete n["clusterIp_"+e],{environmentId:e,gatedServiceId:t,gatedIps:a}})),n.id=e.id,console.info("value:"+JSON.stringify(n)),t.next=6,Object(c["b"])(n);case 6:e.closeConfigOptions(),e.loadTabledata();case 8:case"end":return t.stop()}}),t)})));function n(e){return t.apply(this,arguments)}return n}()})}})}),h={data:function(){return{components:{OpFreight:m["a"]},diaSyncOptions:{visible:!1,ref:"diaSyncform",diatitle:"环境选择",forms:[{prop:"envIds",label:"环境选择",itemType:"checkbox",options:[],rules:[{required:!0,message:"请选择同步环境",trigger:"blur"}]}],currentFormValue:{},loading:!1},consumerId:[],serverType:"",environmentId:void 0,envList:void 0}},methods:{operateEnvList:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.diaSyncOptions.loading=!0,t.next=3,Object(c["j"])();case 3:n=t.sent,e.envList=n.result,e.diaSyncOptions.loading=!1;case 6:case"end":return t.stop()}}),t)})))()},syncOpen:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.operateEnvList();case 2:if(e.selections=e.$refs.maintable.getTableSelections(),n=e.selections,!(0===n.length||n.length<1)){t.next=9;break}return a="请选择数据！",n.length>1&&(a="请选择一条数据！"),e.message("error",a),t.abrupt("return");case 9:e.consumerId=[],e.selections.forEach((function(t){e.consumerId.push(t.id)})),e.handleDia({options:e.diaSyncOptions,cb:function(){Object.assign(e.diaSyncOptions.forms[0],{options:e.envList.map((function(e){return Object(s["a"])({label:e.environmentName,value:e.id},e)}))})}});case 12:case"end":return t.stop()}}),t)})))()},closeSyncDia:function(){Object.assign(this.diaSyncOptions,{visible:!1})},beginSync:function(){var e=this;this.handleValidate({refname:"diaSyncform",cb:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(n){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n.consumerIds=e.consumerId,t.next=3,Object(c["f"])(n);case 3:a=t.sent,a.result&&(r="",a.result.map((function(e){r+="该环境 :"+e.envName+","+e.errorMsg+";"})),e.message("success",null==r?"同步成功":r)),e.closeSyncDia(),e.loadTabledata();case 7:case"end":return t.stop()}}),t)})));function n(e){return t.apply(this,arguments)}return n}()})}}},O=n("ca00"),y={name:"consumerList",mixins:[o["b"],o["a"],l,f,b,v,h],components:{OpFreight:m["a"]},data:function(){return{keyWord:"",status:"",maintable:{ref:"maintable",columns:[{type:"selection",width:50,fixed:"left"},{prop:"broadcastTxt",label:"是否广播",width:80},{prop:"topicName",label:"主题名",width:250},{prop:"applicant",label:"申请人",width:150},{prop:"domain",label:"申请域(appId)",width:200},{prop:"delayThreadhold",label:"积压阈值",width:150},{prop:"memo",label:"备注","min-width":300},{prop:"modifyDate",label:"修改时间",width:160}],data:[],insertNum:1,insertNum2:1,insertNum3:1,insertNum4:5,loading:!1,pageIndex:1,pageSize:25,currentPage:1,pagePagination:!0}}},created:function(){this.loadTabledata()},methods:{goServiceDetail:function(e,t){this.$router.push({name:"serviceHome",params:{id:e,tab:t}})},pageHandler:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.assembleData(e);this.loadTabledata(t)},assembleData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.status=this.status,e.keyWord=this.keyWord,e},statusChange:function(e){this.status=e;var t=this.assembleData();this.loadTabledata(t)},searchMaintable:function(){var e=this.assembleData();this.loadTabledata(e)},loadTabledata:function(){var e=arguments,t=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var a,r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a=e.length>0&&void 0!==e[0]?e[0]:{},t.maintable.loading=!0,a.currentPage||(a.currentPage=t.maintable.currentPage,a.pageSize=t.maintable.pageSize),n.next=5,Object(c["e"])(a);case 5:r=n.sent,r.result&&(t.maintable.data=r.result.records,t.maintable.currentPage=r.result.currentPage,t.maintable.pageSize=r.result.pageSize,t.maintable.total=r.result.total,t.maintable.loading=!1);case 7:case"end":return n.stop()}}),n)})))()},handleTableData:function(e){var t=e.modifyDate,n=e.status,a=e.broadcast,r=e.consumerEnvironmentRefVos;return Object.assign(e,{statusTxt:0===n||2===n?"待审批":"已审批",statusClass:0===n||2===n?"wait":"done",broadcastTxt:1==a?"是":"否",modifyDate:O["a"].dateToStr(new Date(t),3),envTxt:r?r.map((function(e){return e.environmentName})).join(" "):""}),e},viewDetail:function(e){this.$router.push({name:"consumerDetail",params:{id:e.id}})},envType:function(e){var t=e%5;switch(t){case 0:return"content_envTxt_color_0";case 1:return"content_envTxt_color_1";case 2:return"content_envTxt_color_2";case 3:return"content_envTxt_color_3";case 4:return"content_envTxt_color_4";default:return""}},serviceIconClass:function(e){switch(e){case"ZOOKEEPER":return"Zookeeper";case"INFLUXDB":return"influxDb";case"ZMS_ALERT":return"gaojing";case"ZMS_COLLECTOR":return"caiji";case"ROCKETMQ":return"RocketMQ";case"KAFKA":return"Kafka";case"ZMS_BACKUP_CLUSTER":return"backup";default:return""}}}},w=y,_=(n("b567"),n("2877")),j=Object(_["a"])(w,a,r,!1,null,null,null);t["default"]=j.exports},d58f5:function(e,t,n){},d81d:function(e,t,n){"use strict";var a=n("23e7"),r=n("b727").map,i=n("1dde");a({target:"Array",proto:!0,forced:!i("map")},{map:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}})},d9d3:function(e,t,n){"use strict";n.d(t,"o",(function(){return o})),n.d(t,"n",(function(){return s})),n.d(t,"e",(function(){return c})),n.d(t,"h",(function(){return u})),n.d(t,"i",(function(){return l})),n.d(t,"a",(function(){return d})),n.d(t,"c",(function(){return p})),n.d(t,"b",(function(){return m})),n.d(t,"m",(function(){return f})),n.d(t,"l",(function(){return g})),n.d(t,"f",(function(){return b})),n.d(t,"g",(function(){return v})),n.d(t,"d",(function(){return h})),n.d(t,"s",(function(){return O})),n.d(t,"k",(function(){return y})),n.d(t,"r",(function(){return w})),n.d(t,"q",(function(){return _})),n.d(t,"p",(function(){return j})),n.d(t,"j",(function(){return k}));var a=n("b775"),r=n("51be"),i=r["a"];function o(e){return Object(a["a"])({url:"".concat(i,"/api/consumer/queryApprovedConsumers"),method:"get",params:e})}function s(e){return Object(a["a"])({url:"".concat(i,"/api/consumer/getConsumersByClusterId"),method:"get",params:e})}function c(e){return Object(a["a"])({url:"".concat(i,"/api/consumer/query"),method:"get",params:e})}function u(e){return Object(a["a"])({url:"".concat(i,"/api/consumer/add"),method:"post",data:e})}function l(e,t){return Object(a["a"])({url:"".concat(i,"/api/consumer/update"),method:"put",data:t})}function d(e,t){return Object(a["a"])({url:"".concat(i,"/api/consumer/approve"),method:"post",data:t})}function p(e){return Object(a["a"])({url:"".concat(i,"/api/consumer/delete"),method:"post",data:e})}function m(e){return Object(a["a"])({url:"".concat(i,"/api/consumer/updateGated"),method:"post",data:e})}function f(e){return Object(a["a"])({url:"".concat(i,"/api/rocketmq/cmd/consumerStatusAllNew"),method:"get",params:e})}function g(e){return Object(a["a"])({url:"".concat(i,"/api/kafka/cmd/consumerSummary"),method:"get",params:e})}function b(e){return Object(a["a"])({url:"".concat(i,"/api/consumer/copyConsumers"),method:"post",data:e})}function v(e){return Object(a["a"])({url:"".concat(i,"/api/consumer/consumerZmsRegister"),method:"post",data:e})}function h(e){return Object(a["a"])({url:"".concat(i,"/api/statistics/queryConsumerGroupMetricsNew"),method:"get",params:e})}function O(e){return Object(a["a"])({url:"".concat(i,"/api/statistics/queryTopicMetricsNew"),method:"get",params:e})}function y(e){return Object(a["a"])({url:"".concat(i,"/api/statistics/queryConsumerClients"),method:"get",params:e})}function w(e){return Object(a["a"])({url:"".concat(i,"/api/statistics/queryConsumerUserCostTimeMs"),method:"get",params:e})}function _(e){return Object(a["a"])({url:"".concat(i,"/api/statistics/queryConsumeSuccessRate"),method:"get",params:e})}function j(e){return Object(a["a"])({url:"".concat(i,"/api/statistics/queryConsumeFailureRate"),method:"get",params:e})}function k(){return Object(a["a"])({url:"".concat(i,"/api/env/listEnvironment"),method:"get"})}},e350:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i}));n("caad"),n("45fc"),n("2532");var a=n("4360"),r=function(e){if(e&&e instanceof Array&&e.length>0){var t=a["a"].getters&&a["a"].getters.permissions,n=e,r=t.some((function(e){return n.includes(e)}));return!!r}return console.error("need roles! Like v-if=\"checkPerm['op_editor']\""),!1},i=function(e){var t=a["a"].getters.userInfo.realName;return e===t}}}]);