(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a748d3aa"],{"1b62":function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return h}));n("d81d");var a=n("cdd9"),i={data:function(){return{isCollapse:!1,reSubmit:!1,loading:!1,opTitle:"",opType:"",opKey:1,opDialog:!1,clearFk:1,mulSelection:[]}},methods:{commonEdit:function(t){var e=this;this.opType="edit",this.modalData=t,this.opKey++,setTimeout((function(){e.opDialog=!0}),a["a"].modalTime)},commonAdd:function(){var t=this;this.opType="add",this.opKey++,setTimeout((function(){t.opDialog=!0}),a["a"].modalTime)},callbackModal:function(){this.fetchData()},onReset:function(){this.$refs["formData"].resetFields(),this.clearFk++},handleSelectionChange:function(t){this.mulSelection=t},preDeleteBatch:function(t){var e=[];this.mulSelection.map((function(n){e.push(n[t])})),this.handleDelete(e)},preDelete:function(t,e,n){n&&n.stopPropagation();var a=[t[e]];this.handleDelete(a)}}},r=n("5530"),o=n("f66f"),s=n("1a40"),c=n("5d85"),l=n("94d2"),u=n("2f62"),d=n("e350"),h={components:{tablePagination:o["a"],OperateButton:s["a"],baseForm:c["a"],colorWord:l["a"]},computed:Object(r["a"])({},u["c"]["userInfo"]),methods:{checkPerm:d["a"],checkUser:d["b"],handleDia:function(t){var e=this,n=t.row,a=void 0===n?{}:n,i=t.options,r=t.cb,o=t.nextTickCb;i=Object.assign(i,{visible:!0,currentFormValue:a}),r&&r(),this.$nextTick((function(){o&&o(),i.ref&&e.$refs[i.ref].clear()}))},handleValidate:function(t){var e=this,n=t.refname,a=t.cb;this.$nextTick((function(){e.$refs[n].handleFormValidate((function(t){a&&a(t)}))}))},isDo:function(t){var e=t.cb,n=t.title,a=t.catchcb,i=void 0===a?function(){}:a;this.$confirm(n,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(e).catch(i)},go:function(t){this.$router.push(t)},message:function(t,e){this.$message({message:e,type:t})}}}},3793:function(t,e,n){"use strict";var a=n("bbcf"),i=n.n(a);i.a},4246:function(t,e,n){"use strict";n.d(e,"e",(function(){return o})),n.d(e,"b",(function(){return s})),n.d(e,"a",(function(){return c})),n.d(e,"c",(function(){return l})),n.d(e,"d",(function(){return u})),n.d(e,"f",(function(){return d}));n("99af");var a=n("b775"),i=n("51be"),r=i["a"];function o(t){return Object(a["a"])({url:"".concat(r,"/api/master/env/").concat(t.envId,"/host?pageSize=").concat(t.pageSize,"&currentPage=").concat(t.currentPage,"&hostIp=").concat(t.hostIp),method:"get"})}function s(t,e){return Object(a["a"])({url:"".concat(r,"/api/master/env/").concat(t,"/host/").concat(e),method:"get"})}function c(t){return Object(a["a"])({url:"".concat(r,"/api/master/env/").concat(t,"/hostInit"),method:"get"})}function l(t,e){return Object(a["a"])({url:"".concat(r,"/api/master/env/").concat(t,"/hostDisabled"),method:"post",data:e})}function u(t,e){return Object(a["a"])({url:"".concat(r,"/api/master/env/").concat(t,"/hostEnabled"),method:"post",data:e})}function d(t){return Object(a["a"])({url:"".concat(r,"/api/hostserve/listHostInstanceByEnvId/").concat(t),method:"get"})}},4677:function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"c-dialog"},[n("el-dialog",{directives:[{name:"drag-dialog",rawName:"v-drag-dialog"}],attrs:{title:t.modalTitle,visible:t.dialog,"before-close":t.closeHandle,width:t.width||"580px"},on:{"update:visible":function(e){t.dialog=e}}},[n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[t._t("default"),t._t("table"),n("div",{staticClass:"c-dialog__footer",attrs:{slot:"footer"},slot:"footer"},[t.noCancle?t._e():n("el-button",{attrs:{size:"mini"},on:{click:t.closeHandle}},[t._v("关闭")])],1)],2)])],1)},i=[],r={props:["dialog","modalTitle","callback","refname","loading","width","noCancle"],methods:{closeHandle:function(){this.$emit("dealDialog")}}},o=r,s=n("2877"),c=Object(s["a"])(o,a,i,!1,null,null,null);e["a"]=c.exports},5899:function(t,e){t.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(t,e,n){var a=n("1d80"),i=n("5899"),r="["+i+"]",o=RegExp("^"+r+r+"*"),s=RegExp(r+r+"*$"),c=function(t){return function(e){var n=String(a(e));return 1&t&&(n=n.replace(o,"")),2&t&&(n=n.replace(s,"")),n}};t.exports={start:c(1),end:c(2),trim:c(3)}},"77e91":function(t,e,n){"use strict";n("4160"),n("c975"),n("ac1f"),n("1276"),n("159b");var a=n("b775"),i=n("51be"),r=i["a"],o={validCode:{url:r+"/api/topic/uniqueCheck",method:"get"},applicant:{url:r+"/api/userinfo/queryApplicants",method:"get"},getTopicsByClusterId:{url:r+"/api/topic/getTopicsByClusterId",method:"get"},getTopicsByCluster:{url:r+"/api/topic/getTopicsByCluster",method:"get"}},s={list:{url:r+"/api/env/listEnvironment",method:"get"}},c={list:{url:r+"/api/service/listClusters",method:"get"}},l={list:{url:r+"/api/consumer/queryApprovedConsumers",method:"get"},getApproveTopicList:{url:r+"/api/topic/getTopicsByClusterId",method:"get"},getConsumersByClusterId:{url:r+"/api/consumer/getConsumersByClusterId",method:"get"},validCode:{url:r+"/api/consumer/uniqueCheck",method:"post"}},u={theme:o,cluster:c,consumer:l,environment:s};function d(t){if(-1===t.indexOf("_"))return u[t];var e=u;return t.split("_").forEach((function(t){e=e[t]})),e}e["a"]={accessAPI:function(t){var e=t.apiUrl,n=void 0===e?"":e,i=t.params,r=void 0===i?{}:i,o=t.headers,s=void 0===o?{}:o,c={headers:s},l=d(n);return Object.assign(c,{url:l.url,method:l.method}),"get"===l.method?Object.assign(c,{params:r}):"post"!==l.method&&"put"!==l.method&&"patch"!==l.method&&"delete"!==l.method||Object.assign(c,{data:r}),Object(a["a"])(c)}}},a15b:function(t,e,n){"use strict";var a=n("23e7"),i=n("44ad"),r=n("fc6a"),o=n("b301"),s=[].join,c=i!=Object,l=o("join",",");a({target:"Array",proto:!0,forced:c||l},{join:function(t){return s.call(r(this),void 0===t?",":t)}})},a623:function(t,e,n){"use strict";var a=n("23e7"),i=n("b727").every,r=n("b301");a({target:"Array",proto:!0,forced:r("every")},{every:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}})},a9e3:function(t,e,n){"use strict";var a=n("83ab"),i=n("da84"),r=n("94ca"),o=n("6eeb"),s=n("5135"),c=n("c6b6"),l=n("7156"),u=n("c04e"),d=n("d039"),h=n("7c73"),p=n("241c").f,m=n("06cf").f,f=n("9bf2").f,g=n("58a8").trim,v="Number",b=i[v],y=b.prototype,I=c(h(y))==v,_=function(t){var e,n,a,i,r,o,s,c,l=u(t,!1);if("string"==typeof l&&l.length>2)if(l=g(l),e=l.charCodeAt(0),43===e||45===e){if(n=l.charCodeAt(2),88===n||120===n)return NaN}else if(48===e){switch(l.charCodeAt(1)){case 66:case 98:a=2,i=49;break;case 79:case 111:a=8,i=55;break;default:return+l}for(r=l.slice(2),o=r.length,s=0;s<o;s++)if(c=r.charCodeAt(s),c<48||c>i)return NaN;return parseInt(r,a)}return+l};if(r(v,!b(" 0o1")||!b("0b1")||b("+0x1"))){for(var w,S=function(t){var e=arguments.length<1?0:t,n=this;return n instanceof S&&(I?d((function(){y.valueOf.call(n)})):c(n)!=v)?l(new b(_(e)),n,S):_(e)},T=a?p(b):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),C=0;T.length>C;C++)s(b,w=T[C])&&!s(S,w)&&f(S,w,m(b,w));S.prototype=y,y.constructor=S,o(i,v,S)}},bbcf:function(t,e,n){},d81d:function(t,e,n){"use strict";var a=n("23e7"),i=n("b727").map,r=n("1dde");a({target:"Array",proto:!0,forced:!r("map")},{map:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}})},d891:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"l-page l-page--flex theme-application"},[n("div",{staticClass:"page-nav"},[t._v("主机管理")]),n("div",{staticClass:"l-page__content"},[n("div",{staticClass:"content--padding"},[n("div",{staticClass:"content__header"},[n("div",{staticStyle:{float:"right"}},[t.checkPerm(["admin"])?n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.handleEnabled}},[t._v(" 启用主机 ")]):t._e(),t.checkPerm(["admin"])?n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.handleDisabled}},[t._v(" 停用主机 ")]):t._e(),t.checkPerm(["admin"])?n("el-button",{staticStyle:{float:"right",position:"relative",top:"2px"},attrs:{size:"mini",type:"primary"},on:{click:t.addHost}},[t._v(" 向环境添加主机 ")]):t._e()],1),n("div",{staticStyle:{float:"left"}},[n("el-input",{staticStyle:{padding:"float:right",width:"200px"},attrs:{size:"mini",placeholder:"搜索"},model:{value:t.queryStr,callback:function(e){t.queryStr=e},expression:"queryStr"}})],1)]),n("div",{staticClass:"content__body"},[n("table-pagination",t._b({on:{changePage:t.pageHandler}},"table-pagination",t.maintable,!1),[n("template",{slot:"insert"},[n("el-table-column",t._b({attrs:{label:"主机名称",width:"250"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("color-word",{attrs:{type:"link"},on:{click:function(n){return t.viewDetail(e.row)}}},[t._v(" "+t._s(e.row.hostName)+" ")])]}}])},"el-table-column",t.GLOBAL.column,!1))],1),n("template",{slot:"insert2"},[n("el-table-column",t._b({attrs:{label:"服务",width:"250"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.services?n("div",{staticClass:"service-column"},[e.row.services.length?n("el-popover",{attrs:{placement:"right",width:"200",trigger:"click"}},[n("el-card",{staticClass:"zms-host-card",attrs:{shadow:"never"}},t._l(e.row.services,(function(e,a){return n("div",{key:a},[n("el-tooltip",{attrs:{content:e.serverType.toLowerCase(),placement:"top",effect:"light"}},[n("svg-icon",{attrs:{"icon-class":t.serviceIconClass(e.serverType)}})],1),t.checkPerm(["admin"])||"KAFKA"===e.serverType||"ROCKETMQ"===e.serverType&&"BROKER"===e.instanceType?n("span",{staticClass:"card-item",on:{click:function(n){return t.goInstanceDetail(e.id)}}},[t._v(" "+t._s(e.instanceName)+" ")]):n("span",{staticStyle:{"margin-left":"4px"}},[t._v(t._s(e.instanceName))])],1)})),0),n("el-button",{staticStyle:{border:"0"},attrs:{slot:"reference"},slot:"reference"},[n("span",[t._v(t._s(e.row.services.length||0)+" Service(s)")]),n("i",{staticClass:"el-icon-arrow-right el-icon--right"})])],1):n("span",[t._v("--")])],1):n("div",[t._v(t._s(t._f("isEmpty")(e.row.services)))])]}}])},"el-table-column",t.GLOBAL.column,!1))],1)],2)],1)]),n("op-message",{attrs:{dialog:t.dialog,modalTitle:t.modalTitle,loading:t.loading,width:"800px"},on:{dealDialog:function(e){t.dialog=!1}}},[[n("el-row",{staticStyle:{"margin-bottom":"13px"}},[n("span",[t._v("执行安装脚本：")])]),n("el-row",{staticStyle:{"margin-bottom":"13px"}},[n("span",{staticStyle:{color:"red"}},[t._v("1. 在主机使用root或sudo权限的用户安装脚本。")])]),n("el-row",{staticStyle:{"margin-bottom":"20px"}},[n("el-input",{staticStyle:{width:"700px"},attrs:{disabled:!0},model:{value:t.formData.installUrl,callback:function(e){t.$set(t.formData,"installUrl",e)},expression:"formData.installUrl"}}),n("i",{staticClass:"el-icon-document-copy",staticStyle:{"margin-left":"10px","font-size":"20px"},on:{click:function(e){return t.copy(t.formData.installUrl)}}})],1),n("el-row",{staticStyle:{"margin-bottom":"13px"}},[n("span",{staticStyle:{color:"red"}},[t._v(" 2. 初始化主机建议打开所需防火墙端口 [2000-9999] [10900-10999] [20910-20999] 。 ")])])]],2)],1)])},i=[],r=(n("4160"),n("d3b7"),n("159b"),n("96cf"),n("1da1")),o=n("1b62"),s=n("4246"),c=n("4677"),l=n("ca00"),u={name:"list",mixins:[o["b"],o["a"]],components:{OpMessage:c["a"]},data:function(){return{selections:[],total:0,loading:!1,queryStr:"",envId:0,hostIds:[],hostName:"",modalTitle:"",formData:{installUrl:""},dialog:!1,maintable:{ref:"maintable",columns:[{type:"selection",width:50,fixed:"left"},{prop:"environmentName",label:"环境",width:250},{prop:"hostIp",label:"IP",width:150},{prop:"hostStatusTxt",label:"主机状态",width:200},{prop:"lastMonitorTime",label:"上次检测信号时间",width:150},{prop:"totalMem",label:"内存","min-width":300},{prop:"cpuRate",label:"CPU占用率",width:160}],data:[],insertNum:1,insertNum2:1,loading:!1,pageIndex:1,pageSize:25,currentPage:1,pagePagination:!0}}},created:function(){var t=this.$route.params.envId;this.envId=t,this.pageHandler()},watch:{queryStr:function(t){this.queryStr=t,this.pageHandler()}},methods:{copy:function(t){var e=t,n=document.createElement("input");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("Copy"),this.$message({message:"复制成功",type:"success"}),n.remove()},closeHandle:function(){this.dialog=!1},addHost:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.modalTitle="脚本安装",e.next=3,Object(s["a"])(t.envId);case 3:n=e.sent,t.formData.installUrl=n.result,t.dialog=!0;case 6:case"end":return e.stop()}}),e)})))()},handleEnabled:function(){var t=this;this.selections=this.$refs.maintable.getTableSelections();var e=this.selections;if(0===e.length||e.length<1){var n="请选择数据！";return e.length>1&&(n="请选择一条数据！"),void this.message("error",n)}this.hostId=[],this.hostName="";var a=0;this.selections.forEach((function(e){t.hostIds.push(e.id),t.hostName+=e.hostName,a<t.selections.length-1&&(t.hostName+=";\n",a++)}));var i={hostIds:this.hostIds};this.isDo({title:"您是否确定启用主机【".concat(this.hostName,"】？"),cb:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(s["d"])(t.envId,i);case 2:t.message("success","启用成功"),t.pageHandler();case 4:case"end":return e.stop()}}),e)})));function n(){return e.apply(this,arguments)}return n}()})},handleDisabled:function(){var t=this;this.selections=this.$refs.maintable.getTableSelections();var e=this.selections;if(0===e.length||e.length<1){var n="请选择数据！";return e.length>1&&(n="请选择一条数据！"),void this.message("error",n)}this.hostId=[],this.hostName="",this.selections.forEach((function(e){t.hostIds.push(e.id),t.hostName+=e.hostName+";\n"}));var a={hostIds:this.hostIds};this.isDo({title:"您是否确定停用主机【".concat(this.hostName,"】？"),cb:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(s["c"])(t.envId,a);case 2:t.message("success","停用成功"),t.pageHandler();case 4:case"end":return e.stop()}}),e)})));function n(){return e.apply(this,arguments)}return n}()})},isDo:function(t){var e=t.cb,n=t.title,a=t.catchcb,i=void 0===a?function(){}:a;this.$confirm(n,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(e).catch(i)},message:function(t,e){this.$message({message:e,type:t})},goInstanceDetail:function(t){this.$router.push({name:"instanceHome",params:{id:t}})},viewDetail:function(t){this.$router.push({name:"hostDetail",params:{id:t.id,envId:t.environmentId}})},pageHandler:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.assembleData(t);this.queryEvent(e)},assembleData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.envId=this.envId,t.hostIp=this.queryStr,t},queryEvent:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.maintable.loading=!0,e.currentPage||(e.currentPage=this.maintable.currentPage,e.pageSize=this.maintable.pageSize),Object(s["e"])(e).then((function(e){t.maintable.loading=!1;var n=e.result;n.records.forEach((function(t){var e=t.lastMonitorTime,n=t.hostStatus;return Object.assign(t,{lastMonitorTime:null==e?"":l["a"].dateToStr(new Date(e),3),hostStatusTxt:"ENABLE"===n?"可用":"禁用"}),t})),n&&(t.maintable.data=n.records||[],t.maintable.currentPage=n.currentPage,t.maintable.pageSize=n.pageSize,t.maintable.total=n.total)})).finally((function(){t.maintable.loading=!1}))},serviceIconClass:function(t){switch(t){case"ZOOKEEPER":return"Zookeeper";case"INFLUXDB":return"influxDb";case"ZMS_ALERT":return"gaojing";case"ZMS_COLLECTOR":return"caiji";case"ROCKETMQ":return"RocketMQ";case"KAFKA":return"Kafka";case"ZMS_BACKUP_CLUSTER":return"backup";default:return""}}},mounted:function(){}},d=u,h=(n("3793"),n("2877")),p=Object(h["a"])(d,a,i,!1,null,null,null);e["default"]=p.exports},e350:function(t,e,n){"use strict";n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return r}));n("caad"),n("45fc"),n("2532");var a=n("4360"),i=function(t){if(t&&t instanceof Array&&t.length>0){var e=a["a"].getters&&a["a"].getters.permissions,n=t,i=e.some((function(t){return n.includes(t)}));return!!i}return console.error("need roles! Like v-if=\"checkPerm['op_editor']\""),!1},r=function(t){var e=a["a"].getters.userInfo.realName;return t===e}}}]);